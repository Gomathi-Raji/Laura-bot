<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Laura-bot - Learning</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Laura-bot">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-app.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Real-time -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
</head>
<body>
    <div class="mobile-app">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <div class="mobile-header-nav">
                <button class="mobile-header-btn" onclick="history.back()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="mobile-header-title">
                    <i class="fas fa-graduation-cap"></i>
                    Learning
                </div>
                <button class="mobile-header-btn" id="learn-menu-btn">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </header>

        <!-- Mobile Content -->
        <main class="mobile-content">
            <!-- Subject Selection -->
            <section class="mobile-section">
                <h2 class="mobile-section-title">
                    <i class="fas fa-books"></i>
                    Choose Your Subject
                </h2>
                <div class="subjects-grid">
                    <div class="mobile-card subject-card" data-subject="mathematics">
                        <div class="subject-icon" style="background: linear-gradient(135deg, #6366f1, #4f46e5);">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="subject-content">
                            <h3>Mathematics</h3>
                            <p>Algebra, Geometry, Calculus</p>
                            <div class="subject-progress">
                                <div class="subject-progress-bar">
                                    <div class="subject-progress-fill" style="width: 65%"></div>
                                </div>
                                <span class="subject-progress-text">65% Complete</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right subject-arrow"></i>
                    </div>

                    <div class="mobile-card subject-card" data-subject="science">
                        <div class="subject-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="subject-content">
                            <h3>Science</h3>
                            <p>Physics, Chemistry, Biology</p>
                            <div class="subject-progress">
                                <div class="subject-progress-bar">
                                    <div class="subject-progress-fill" style="width: 42%"></div>
                                </div>
                                <span class="subject-progress-text">42% Complete</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right subject-arrow"></i>
                    </div>

                    <div class="mobile-card subject-card" data-subject="literature">
                        <div class="subject-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="subject-content">
                            <h3>Literature</h3>
                            <p>Reading, Writing, Analysis</p>
                            <div class="subject-progress">
                                <div class="subject-progress-bar">
                                    <div class="subject-progress-fill" style="width: 78%"></div>
                                </div>
                                <span class="subject-progress-text">78% Complete</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right subject-arrow"></i>
                    </div>

                    <div class="mobile-card subject-card" data-subject="history">
                        <div class="subject-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <i class="fas fa-landmark"></i>
                        </div>
                        <div class="subject-content">
                            <h3>History</h3>
                            <p>World History, Events</p>
                            <div class="subject-progress">
                                <div class="subject-progress-bar">
                                    <div class="subject-progress-fill" style="width: 33%"></div>
                                </div>
                                <span class="subject-progress-text">33% Complete</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right subject-arrow"></i>
                    </div>
                </div>
            </section>

            <!-- Current Lesson -->
            <section class="mobile-section" id="lesson-section" style="display: none;">
                <div class="lesson-header">
                    <button class="mobile-btn mobile-btn-secondary" id="back-to-subjects">
                        <i class="fas fa-arrow-left"></i>
                        Back to Subjects
                    </button>
                    <div class="lesson-info">
                        <h2 id="lesson-title">Advanced Mathematics</h2>
                        <p id="lesson-subtitle">Lesson 5: Quadratic Equations</p>
                    </div>
                </div>

                <!-- Lesson Content Card -->
                <div class="mobile-card lesson-card">
                    <div class="lesson-progress-header">
                        <div class="lesson-step">Step <span id="current-step">1</span> of <span id="total-steps">5</span></div>
                        <div class="lesson-progress-bar">
                            <div class="lesson-progress-fill" id="lesson-progress" style="width: 20%"></div>
                        </div>
                    </div>

                    <div class="lesson-content" id="lesson-content">
                        <div class="lesson-text">
                            <h3>Understanding Quadratic Equations</h3>
                            <p>A quadratic equation is a polynomial equation of degree 2. The general form is:</p>
                            <div class="math-formula">
                                ax² + bx + c = 0
                            </div>
                            <p>Where 'a', 'b', and 'c' are constants, and 'a' ≠ 0.</p>
                        </div>
                        
                        <div class="lesson-visual">
                            <div class="visual-placeholder">
                                <i class="fas fa-chart-area"></i>
                                Interactive Graph
                            </div>
                        </div>
                    </div>

                    <div class="lesson-actions">
                        <button class="mobile-btn mobile-btn-secondary" id="prev-step" disabled>
                            <i class="fas fa-chevron-left"></i>
                            Previous
                        </button>
                        <button class="mobile-btn mobile-btn-primary" id="next-step">
                            Next
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- AI Tutor Chat -->
                <div class="mobile-card ai-tutor-card">
                    <div class="tutor-header">
                        <div class="tutor-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="tutor-info">
                            <h3>AI Tutor</h3>
                            <p class="tutor-status online">Online and ready to help</p>
                        </div>
                    </div>
                    
                    <div class="tutor-messages" id="tutor-messages">
                        <div class="tutor-message">
                            <div class="message-bubble ai-message">
                                Hi! I'm here to help you with quadratic equations. Do you have any questions about what we just covered?
                            </div>
                        </div>
                    </div>

                    <div class="tutor-input-container">
                        <input type="text" class="mobile-input tutor-input" placeholder="Ask me anything..." id="tutor-input">
                        <button class="mobile-btn mobile-btn-primary tutor-send-btn" id="tutor-send">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="mobile-section">
                <h2 class="mobile-section-title">
                    <i class="fas fa-lightning-bolt"></i>
                    Quick Actions
                </h2>
                <div class="quick-actions">
                    <button class="mobile-card action-card" id="practice-problems">
                        <div class="action-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            <i class="fas fa-dumbbell"></i>
                        </div>
                        <div class="action-content">
                            <h3>Practice Problems</h3>
                            <p>Solve interactive exercises</p>
                        </div>
                    </button>

                    <button class="mobile-card action-card" id="study-notes">
                        <div class="action-icon" style="background: linear-gradient(135deg, #6366f1, #4f46e5);">
                            <i class="fas fa-sticky-note"></i>
                        </div>
                        <div class="action-content">
                            <h3>Study Notes</h3>
                            <p>Review key concepts</p>
                        </div>
                    </button>

                    <button class="mobile-card action-card" id="voice-lesson">
                        <div class="action-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <div class="action-content">
                            <h3>Voice Lesson</h3>
                            <p>Learn through conversation</p>
                        </div>
                    </button>
                </div>
            </section>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-bottom-nav">
            <a href="/" class="mobile-nav-item">
                <i class="fas fa-home mobile-nav-icon"></i>
                <span class="mobile-nav-label">Home</span>
            </a>
            <a href="/learn" class="mobile-nav-item active">
                <i class="fas fa-graduation-cap mobile-nav-icon"></i>
                <span class="mobile-nav-label">Learn</span>
            </a>
            <a href="/quiz" class="mobile-nav-item">
                <i class="fas fa-brain mobile-nav-icon"></i>
                <span class="mobile-nav-label">Quiz</span>
            </a>
            <a href="/progress" class="mobile-nav-item">
                <i class="fas fa-chart-line mobile-nav-icon"></i>
                <span class="mobile-nav-label">Progress</span>
            </a>
            <a href="/hardware" class="mobile-nav-item">
                <i class="fas fa-cogs mobile-nav-icon"></i>
                <span class="mobile-nav-label">Hardware</span>
            </a>
        </nav>

        <!-- Floating Action Button -->
        <button class="mobile-fab" id="help-fab" title="Get Help">
            <i class="fas fa-question"></i>
        </button>
    </div>

    <!-- Learning Styles -->
    <style>
        /* Subjects Grid */
        .subjects-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .subject-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .subject-card:active {
            transform: scale(0.98);
        }

        .subject-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .subject-content {
            flex: 1;
        }

        .subject-content h3 {
            margin: 0 0 0.25rem 0;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .subject-content p {
            margin: 0 0 0.75rem 0;
            font-size: 0.875rem;
            opacity: 0.7;
        }

        .subject-progress {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .subject-progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .subject-progress-fill {
            height: 100%;
            background: var(--mobile-primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .subject-progress-text {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--mobile-primary);
            min-width: 80px;
        }

        .subject-arrow {
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.875rem;
        }

        /* Lesson Section */
        .lesson-header {
            margin-bottom: 1.5rem;
        }

        .lesson-info {
            margin-top: 1rem;
        }

        .lesson-info h2 {
            margin: 0 0 0.25rem 0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .lesson-info p {
            margin: 0;
            font-size: 1rem;
            opacity: 0.7;
        }

        .lesson-card {
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .lesson-progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .lesson-step {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--mobile-primary);
        }

        .lesson-progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin-left: 1rem;
            overflow: hidden;
        }

        .lesson-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--mobile-primary), var(--mobile-primary-light));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .lesson-content {
            margin-bottom: 2rem;
        }

        .lesson-text h3 {
            margin: 0 0 1rem 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .lesson-text p {
            margin: 0 0 1rem 0;
            line-height: 1.6;
        }

        .math-formula {
            background: var(--mobile-glass);
            border: 1px solid var(--mobile-glass-border);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.125rem;
            font-weight: 600;
            margin: 1rem 0;
        }

        .lesson-visual {
            margin-top: 1.5rem;
        }

        .visual-placeholder {
            background: var(--mobile-glass);
            border: 2px dashed var(--mobile-glass-border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
        }

        .visual-placeholder i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .lesson-actions {
            display: flex;
            gap: 1rem;
            justify-content: space-between;
        }

        .lesson-actions .mobile-btn {
            flex: 1;
        }

        /* AI Tutor */
        .ai-tutor-card {
            padding: 1rem;
        }

        .tutor-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tutor-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--mobile-primary), var(--mobile-primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }

        .tutor-info h3 {
            margin: 0 0 0.25rem 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .tutor-status {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .tutor-status.online {
            color: var(--mobile-success);
            opacity: 1;
        }

        .tutor-messages {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .tutor-message {
            margin-bottom: 1rem;
        }

        .message-bubble {
            background: var(--mobile-glass);
            border: 1px solid var(--mobile-glass-border);
            border-radius: 1rem 1rem 1rem 0.25rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            line-height: 1.4;
            max-width: 85%;
        }

        .message-bubble.user-message {
            background: var(--mobile-primary);
            border-radius: 1rem 1rem 0.25rem 1rem;
            margin-left: auto;
        }

        .tutor-input-container {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .tutor-input {
            flex: 1;
            margin: 0;
        }

        .tutor-send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            padding: 0;
            flex-shrink: 0;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .action-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            background: var(--mobile-card-bg);
            text-align: left;
        }

        .action-card:active {
            transform: scale(0.98);
        }

        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            flex-shrink: 0;
        }

        .action-content {
            flex: 1;
        }

        .action-content h3 {
            margin: 0 0 0.25rem 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .action-content p {
            margin: 0;
            font-size: 0.875rem;
            opacity: 0.7;
        }
    </style>

    <!-- Learning JavaScript -->
    <script>
        // Initialize Socket.IO
        const socket = io();
        
        // Learning state
        let currentSubject = null;
        let currentStep = 1;
        let totalSteps = 5;
        
        // Initialize learning interface
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            initializeLearning();
        });

        function setupEventListeners() {
            // Subject selection
            document.querySelectorAll('.subject-card').forEach(card => {
                card.addEventListener('click', function() {
                    const subject = this.dataset.subject;
                    selectSubject(subject);
                });
            });
            
            // Back to subjects
            document.getElementById('back-to-subjects').addEventListener('click', function() {
                showSubjectSelection();
            });
            
            // Lesson navigation
            document.getElementById('next-step').addEventListener('click', nextStep);
            document.getElementById('prev-step').addEventListener('click', prevStep);
            
            // AI Tutor
            document.getElementById('tutor-send').addEventListener('click', sendTutorMessage);
            document.getElementById('tutor-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendTutorMessage();
                }
            });
            
            // Quick actions
            document.getElementById('practice-problems').addEventListener('click', function() {
                window.location.href = '/quiz';
            });
            
            document.getElementById('voice-lesson').addEventListener('click', function() {
                startVoiceLesson();
            });
            
            // Help FAB
            document.getElementById('help-fab').addEventListener('click', function() {
                showHelp();
            });
            
            // Touch feedback
            document.querySelectorAll('.subject-card, .action-card').forEach(card => {
                card.addEventListener('touchstart', function() {
                    if ('vibrate' in navigator) {
                        navigator.vibrate(5);
                    }
                });
            });
        }

        function initializeLearning() {
            // Request available subjects from server
            socket.emit('request_subjects');
        }

        function selectSubject(subject) {
            currentSubject = subject;
            
            // Update lesson title
            const titles = {
                'mathematics': 'Advanced Mathematics',
                'science': 'Science Fundamentals',
                'literature': 'Literature & Reading',
                'history': 'World History'
            };
            
            document.getElementById('lesson-title').textContent = titles[subject] || 'Learning';
            
            // Show lesson section
            document.querySelector('.subjects-grid').parentElement.style.display = 'none';
            document.getElementById('lesson-section').style.display = 'block';
            
            // Request lesson content
            socket.emit('start_lesson', { subject: subject });
            
            // Haptic feedback
            if ('vibrate' in navigator) {
                navigator.vibrate(10);
            }
        }

        function showSubjectSelection() {
            document.querySelector('.subjects-grid').parentElement.style.display = 'block';
            document.getElementById('lesson-section').style.display = 'none';
            currentSubject = null;
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateLessonProgress();
                loadLessonStep(currentStep);
                
                // Haptic feedback
                if ('vibrate' in navigator) {
                    navigator.vibrate(10);
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateLessonProgress();
                loadLessonStep(currentStep);
                
                // Haptic feedback
                if ('vibrate' in navigator) {
                    navigator.vibrate(10);
                }
            }
        }

        function updateLessonProgress() {
            document.getElementById('current-step').textContent = currentStep;
            document.getElementById('total-steps').textContent = totalSteps;
            
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('lesson-progress').style.width = progress + '%';
            
            // Update button states
            document.getElementById('prev-step').disabled = currentStep === 1;
            document.getElementById('next-step').textContent = currentStep === totalSteps ? 'Complete' : 'Next';
        }

        function loadLessonStep(step) {
            // Request lesson step content from server
            socket.emit('load_lesson_step', { 
                subject: currentSubject, 
                step: step 
            });
        }

        function sendTutorMessage() {
            const input = document.getElementById('tutor-input');
            const message = input.value.trim();
            
            if (message) {
                // Add user message
                addTutorMessage(message, 'user');
                
                // Send to AI tutor
                socket.emit('tutor_question', { 
                    message: message,
                    subject: currentSubject,
                    step: currentStep
                });
                
                // Clear input
                input.value = '';
                
                // Show typing indicator
                showTutorTyping();
            }
        }

        function addTutorMessage(message, sender) {
            const messagesContainer = document.getElementById('tutor-messages');
            const messageElement = document.createElement('div');
            messageElement.className = 'tutor-message';
            
            const bubbleClass = sender === 'user' ? 'message-bubble user-message' : 'message-bubble ai-message';
            messageElement.innerHTML = `<div class="${bubbleClass}">${message}</div>`;
            
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTutorTyping() {
            const messagesContainer = document.getElementById('tutor-messages');
            const typingElement = document.createElement('div');
            typingElement.className = 'tutor-message typing-indicator';
            typingElement.innerHTML = `
                <div class="message-bubble ai-message">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(typingElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function startVoiceLesson() {
            // Start voice interaction
            socket.emit('start_voice_lesson', { subject: currentSubject });
            
            // Show voice indicator
            const fab = document.getElementById('help-fab');
            fab.innerHTML = '<i class="fas fa-microphone"></i>';
            fab.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
            
            // Haptic feedback
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            }
        }

        function showHelp() {
            addTutorMessage("Hi! I'm your AI tutor. I can help you understand concepts, solve problems, and answer questions. Just ask me anything about what you're learning!", 'ai');
        }

        // Socket.IO event handlers
        socket.on('lesson_content', function(data) {
            // Update lesson content with server data
            if (data.content) {
                document.querySelector('.lesson-text').innerHTML = data.content;
            }
            
            if (data.totalSteps) {
                totalSteps = data.totalSteps;
                updateLessonProgress();
            }
        });

        socket.on('tutor_response', function(data) {
            // Remove typing indicator
            document.querySelectorAll('.typing-indicator').forEach(el => el.remove());
            
            // Add AI response
            addTutorMessage(data.message, 'ai');
        });

        socket.on('subjects_list', function(data) {
            // Update subjects with real data from server
            console.log('Available subjects:', data.subjects);
        });

        // Add typing animation styles
        const style = document.createElement('style');
        style.textContent = `
            .typing-dots {
                display: flex;
                gap: 4px;
                align-items: center;
            }
            
            .typing-dots span {
                width: 6px;
                height: 6px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                animation: typing-bounce 1.4s infinite;
            }
            
            .typing-dots span:nth-child(2) {
                animation-delay: 0.2s;
            }
            
            .typing-dots span:nth-child(3) {
                animation-delay: 0.4s;
            }
            
            @keyframes typing-bounce {
                0%, 60%, 100% {
                    transform: translateY(0);
                    opacity: 0.4;
                }
                30% {
                    transform: translateY(-10px);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>