<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Laura-bot - AI Learning Assistant</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Laura-bot">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/icon-180.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/icon-32.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- Fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" as="style">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-app.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Real-time -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
    
    <!-- Chart.js for mobile -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
</head>
<body>
    <div class="mobile-app">
        <!-- Mobile Header -->
        <header class="mobile-header" id="mobile-header">
            <div class="mobile-header-title">
                <i class="fas fa-robot"></i>
                Laura-bot
            </div>
            <div class="mobile-header-actions">
                <button class="mobile-header-btn" id="notifications-btn">
                    <i class="fas fa-bell"></i>
                    <span class="mobile-badge" id="notification-count">3</span>
                </button>
                <button class="mobile-header-btn" id="profile-btn">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </header>

        <!-- Mobile Content -->
        <main class="mobile-content" id="mobile-content">
            <!-- Welcome Section -->
            <section class="mobile-section">
                <div class="mobile-card" style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(6, 182, 212, 0.2)); border: 1px solid rgba(79, 70, 229, 0.3);">
                    <div class="mobile-card-header">
                        <div class="mobile-card-title">
                            <i class="fas fa-sparkles mobile-card-icon"></i>
                            Welcome Back!
                        </div>
                        <div id="greeting-time" class="text-sm opacity-75"></div>
                    </div>
                    <div class="mobile-card-content">
                        <p>Ready to continue your learning journey? Let's make today amazing!</p>
                        <div class="mobile-progress" style="margin-top: 1rem;">
                            <div class="mobile-progress-fill" style="width: 75%"></div>
                        </div>
                        <p style="margin-top: 0.5rem; font-size: 0.875rem; opacity: 0.8;">75% Daily Goal Complete</p>
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="mobile-section">
                <h2 class="mobile-section-title">
                    <i class="fas fa-bolt"></i>
                    Quick Actions
                </h2>
                <div class="quick-actions-grid">
                    <a href="/learn" class="mobile-card quick-action-card">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="quick-action-content">
                            <div class="mobile-card-title">Start Learning</div>
                            <p>Continue your lessons</p>
                        </div>
                        <i class="fas fa-chevron-right quick-action-arrow"></i>
                    </a>

                    <a href="/quiz" class="mobile-card quick-action-card">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="quick-action-content">
                            <div class="mobile-card-title">Take Quiz</div>
                            <p>Test your knowledge</p>
                        </div>
                        <i class="fas fa-chevron-right quick-action-arrow"></i>
                    </a>

                    <a href="/progress" class="mobile-card quick-action-card">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #6366f1, #4f46e5);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="quick-action-content">
                            <div class="mobile-card-title">View Progress</div>
                            <p>Track your achievements</p>
                        </div>
                        <i class="fas fa-chevron-right quick-action-arrow"></i>
                    </a>

                    <a href="/hardware" class="mobile-card quick-action-card">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="quick-action-content">
                            <div class="mobile-card-title">Hardware</div>
                            <p>Control your robot</p>
                        </div>
                        <i class="fas fa-chevron-right quick-action-arrow"></i>
                    </a>
                </div>
            </section>

            <!-- Today's Stats -->
            <section class="mobile-section">
                <h2 class="mobile-section-title">
                    <i class="fas fa-calendar-day"></i>
                    Today's Stats
                </h2>
                <div class="stats-grid">
                    <div class="mobile-card stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="lessons-completed">12</div>
                            <div class="stat-label">Lessons</div>
                        </div>
                    </div>

                    <div class="mobile-card stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="time-spent">2h 35m</div>
                            <div class="stat-label">Study Time</div>
                        </div>
                    </div>

                    <div class="mobile-card stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #6366f1, #4f46e5);">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="achievements">8</div>
                            <div class="stat-label">Achievements</div>
                        </div>
                    </div>

                    <div class="mobile-card stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="streak-days">15</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recent Activity -->
            <section class="mobile-section">
                <h2 class="mobile-section-title">
                    <i class="fas fa-history"></i>
                    Recent Activity
                </h2>
                <div class="activity-list" id="activity-list">
                    <div class="mobile-card activity-item">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Completed: Advanced Mathematics</div>
                            <div class="activity-meta">Score: 95% • 25 minutes ago</div>
                        </div>
                        <div class="activity-score">95%</div>
                    </div>

                    <div class="mobile-card activity-item">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Quiz: Science Fundamentals</div>
                            <div class="activity-meta">8/10 correct • 1 hour ago</div>
                        </div>
                        <div class="activity-score">80%</div>
                    </div>

                    <div class="mobile-card activity-item">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Hardware Test: Servo Control</div>
                            <div class="activity-meta">All systems online • 2 hours ago</div>
                        </div>
                        <div class="activity-score">OK</div>
                    </div>
                </div>
            </section>

            <!-- AI Assistant Chat Preview -->
            <section class="mobile-section">
                <h2 class="mobile-section-title">
                    <i class="fas fa-comments"></i>
                    AI Assistant
                </h2>
                <div class="mobile-card chat-preview">
                    <div class="chat-messages" id="chat-preview">
                        <div class="chat-message ai-message">
                            <div class="chat-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="chat-bubble">
                                Hi! I noticed you're doing great with mathematics. Would you like to try some advanced calculus problems?
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="mobile-input chat-input" placeholder="Ask me anything..." id="chat-input">
                        <button class="mobile-btn mobile-btn-primary chat-send-btn" id="chat-send">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Upcoming Reminders -->
            <section class="mobile-section">
                <h2 class="mobile-section-title">
                    <i class="fas fa-bell"></i>
                    Upcoming
                </h2>
                <div class="reminders-list">
                    <div class="mobile-card reminder-item">
                        <div class="reminder-time">
                            <div class="time-value">3:00 PM</div>
                            <div class="time-label">Today</div>
                        </div>
                        <div class="reminder-content">
                            <div class="reminder-title">Physics Study Session</div>
                            <div class="reminder-description">Review Newton's Laws</div>
                        </div>
                        <button class="mobile-btn mobile-btn-secondary btn-sm">
                            <i class="fas fa-check"></i>
                        </button>
                    </div>

                    <div class="mobile-card reminder-item">
                        <div class="reminder-time">
                            <div class="time-value">7:00 PM</div>
                            <div class="time-label">Today</div>
                        </div>
                        <div class="reminder-content">
                            <div class="reminder-title">Daily Quiz Challenge</div>
                            <div class="reminder-description">Mixed topics quiz</div>
                        </div>
                        <button class="mobile-btn mobile-btn-secondary btn-sm">
                            <i class="fas fa-clock"></i>
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-bottom-nav">
            <a href="/" class="mobile-nav-item active">
                <i class="fas fa-home mobile-nav-icon"></i>
                <span class="mobile-nav-label">Home</span>
            </a>
            <a href="/learn" class="mobile-nav-item">
                <i class="fas fa-graduation-cap mobile-nav-icon"></i>
                <span class="mobile-nav-label">Learn</span>
            </a>
            <a href="/quiz" class="mobile-nav-item">
                <i class="fas fa-brain mobile-nav-icon"></i>
                <span class="mobile-nav-label">Quiz</span>
            </a>
            <a href="/progress" class="mobile-nav-item">
                <i class="fas fa-chart-line mobile-nav-icon"></i>
                <span class="mobile-nav-label">Progress</span>
            </a>
            <a href="/hardware" class="mobile-nav-item">
                <i class="fas fa-cogs mobile-nav-icon"></i>
                <span class="mobile-nav-label">Hardware</span>
            </a>
        </nav>

        <!-- Floating Action Button -->
        <button class="mobile-fab" id="voice-fab" title="Voice Assistant">
            <i class="fas fa-microphone"></i>
        </button>
    </div>

    <!-- Mobile Notification Modal -->
    <div class="mobile-modal" id="notifications-modal">
        <div class="mobile-modal-content">
            <div class="mobile-modal-handle"></div>
            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-bell"></i>
                Notifications
            </h3>
            <div class="notifications-list">
                <div class="mobile-card notification-item">
                    <div class="notification-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">Achievement Unlocked!</div>
                        <div class="notification-text">You've completed 50 math lessons</div>
                        <div class="notification-time">5 minutes ago</div>
                    </div>
                </div>

                <div class="mobile-card notification-item">
                    <div class="notification-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">Study Reminder</div>
                        <div class="notification-text">Time for your physics review session</div>
                        <div class="notification-time">15 minutes ago</div>
                    </div>
                </div>

                <div class="mobile-card notification-item">
                    <div class="notification-icon" style="background: linear-gradient(135deg, #6366f1, #4f46e5);">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">New Feature Available</div>
                        <div class="notification-text">Try the new voice interaction mode</div>
                        <div class="notification-time">1 hour ago</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pull to Refresh -->
    <div class="mobile-pull-refresh" id="pull-refresh">
        <i class="fas fa-sync-alt mobile-pull-refresh-icon"></i>
        Pull to refresh
    </div>

    <!-- Mobile App Styles -->
    <style>
        /* Quick Actions Grid */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .quick-action-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s ease;
        }

        .quick-action-card:active {
            transform: scale(0.98);
        }

        .quick-action-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            flex-shrink: 0;
        }

        .quick-action-content {
            flex: 1;
        }

        .quick-action-content .mobile-card-title {
            margin-bottom: 0.25rem;
            font-size: 1rem;
        }

        .quick-action-content p {
            margin: 0;
            font-size: 0.875rem;
            opacity: 0.7;
        }

        .quick-action-arrow {
            color: rgba(255, 255, 255, 0.4);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            text-align: center;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            flex-shrink: 0;
        }

        .stat-content {
            flex: 1;
            text-align: left;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        /* Activity List */
        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: white;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .activity-meta {
            font-size: 0.75rem;
            opacity: 0.6;
        }

        .activity-score {
            font-weight: 600;
            color: var(--mobile-success);
            font-size: 0.875rem;
        }

        /* Chat Preview */
        .chat-preview {
            padding: 1rem;
        }

        .chat-messages {
            margin-bottom: 1rem;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--mobile-primary), var(--mobile-primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .chat-bubble {
            background: var(--mobile-glass);
            border: 1px solid var(--mobile-glass-border);
            border-radius: 1rem 1rem 1rem 0.25rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            line-height: 1.4;
            max-width: 280px;
        }

        .chat-input-container {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            margin: 0;
        }

        .chat-send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            padding: 0;
            flex-shrink: 0;
        }

        /* Reminders */
        .reminders-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .reminder-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
        }

        .reminder-time {
            text-align: center;
            min-width: 60px;
        }

        .time-value {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--mobile-primary);
        }

        .time-label {
            font-size: 0.75rem;
            opacity: 0.6;
        }

        .reminder-content {
            flex: 1;
        }

        .reminder-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .reminder-description {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .btn-sm {
            min-height: 32px;
            padding: 0 0.75rem;
            font-size: 0.75rem;
        }

        /* Notifications */
        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .notification-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
        }

        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: white;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .notification-text {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 0.7rem;
            opacity: 0.5;
        }

        /* Mobile specific adjustments */
        @media (max-width: 375px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                justify-content: center;
                text-align: center;
            }
            
            .stat-content {
                text-align: center;
            }
        }
    </style>

    <!-- Mobile App JavaScript -->
    <script>
        // Initialize Socket.IO
        const socket = io();
        
        // Mobile app state
        let pullRefreshActive = false;
        let startY = 0;
        
        // Initialize mobile app
        document.addEventListener('DOMContentLoaded', function() {
            initializeMobileApp();
            setupEventListeners();
            updateGreeting();
            loadDashboardData();
        });

        function initializeMobileApp() {
            // Set up PWA-like behavior
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/static/sw.js');
            }
            
            // Handle header scroll effect
            const header = document.getElementById('mobile-header');
            const content = document.getElementById('mobile-content');
            
            content.addEventListener('scroll', function() {
                if (content.scrollTop > 10) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
            
            // Set up pull to refresh
            setupPullToRefresh();
            
            // Initialize touch gestures
            setupTouchGestures();
        }

        function setupEventListeners() {
            // Notifications modal
            document.getElementById('notifications-btn').addEventListener('click', function() {
                document.getElementById('notifications-modal').classList.add('active');
            });
            
            // Close modal on backdrop click
            document.getElementById('notifications-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
            
            // Voice FAB
            document.getElementById('voice-fab').addEventListener('click', function() {
                startVoiceInteraction();
            });
            
            // Chat input
            document.getElementById('chat-send').addEventListener('click', function() {
                sendChatMessage();
            });
            
            document.getElementById('chat-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
            
            // Navigation haptic feedback
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    // Haptic feedback on supported devices
                    if ('vibrate' in navigator) {
                        navigator.vibrate(10);
                    }
                });
            });
            
            // Card tap feedback
            document.querySelectorAll('.mobile-card').forEach(card => {
                card.addEventListener('touchstart', function() {
                    if ('vibrate' in navigator) {
                        navigator.vibrate(5);
                    }
                });
            });
        }

        function setupPullToRefresh() {
            const content = document.getElementById('mobile-content');
            const pullRefresh = document.getElementById('pull-refresh');
            
            content.addEventListener('touchstart', function(e) {
                startY = e.touches[0].pageY;
            });
            
            content.addEventListener('touchmove', function(e) {
                if (content.scrollTop === 0) {
                    const currentY = e.touches[0].pageY;
                    const pullDistance = currentY - startY;
                    
                    if (pullDistance > 60 && !pullRefreshActive) {
                        pullRefresh.classList.add('active');
                        pullRefreshActive = true;
                        
                        if ('vibrate' in navigator) {
                            navigator.vibrate(20);
                        }
                    }
                }
            });
            
            content.addEventListener('touchend', function() {
                if (pullRefreshActive) {
                    refreshDashboard();
                    
                    setTimeout(() => {
                        pullRefresh.classList.remove('active');
                        pullRefreshActive = false;
                    }, 2000);
                }
            });
        }

        function setupTouchGestures() {
            // Add swipe gestures for navigation
            let touchStartX = 0;
            let touchStartY = 0;
            
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            });
            
            document.addEventListener('touchend', function(e) {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                
                const deltaX = touchEndX - touchStartX;
                const deltaY = touchEndY - touchStartY;
                
                // Horizontal swipe detection
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                    if (deltaX > 0) {
                        // Swipe right - could navigate back
                        console.log('Swipe right detected');
                    } else {
                        // Swipe left - could navigate forward
                        console.log('Swipe left detected');
                    }
                }
            });
        }

        function updateGreeting() {
            const now = new Date();
            const hour = now.getHours();
            const greetingElement = document.getElementById('greeting-time');
            
            let greeting = '';
            if (hour < 12) {
                greeting = 'Good Morning';
            } else if (hour < 18) {
                greeting = 'Good Afternoon';
            } else {
                greeting = 'Good Evening';
            }
            
            greetingElement.textContent = greeting;
        }

        function loadDashboardData() {
            // Request dashboard data from server
            socket.emit('request_dashboard_data');
        }

        function refreshDashboard() {
            // Refresh all dashboard data
            updateGreeting();
            loadDashboardData();
            
            // Animate stats counters
            animateCounters();
        }

        function animateCounters() {
            const counters = [
                { id: 'lessons-completed', target: 12 },
                { id: 'achievements', target: 8 },
                { id: 'streak-days', target: 15 }
            ];
            
            counters.forEach(counter => {
                const element = document.getElementById(counter.id);
                animateCounter(element, counter.target);
            });
        }

        function animateCounter(element, target) {
            let current = 0;
            const increment = target / 20;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 50);
        }

        function startVoiceInteraction() {
            const fab = document.getElementById('voice-fab');
            
            // Change FAB to listening state
            fab.innerHTML = '<i class="fas fa-stop"></i>';
            fab.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
            
            // Haptic feedback
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            }
            
            // Request speech recognition
            socket.emit('speech_recognition', { timeout: 5 });
            
            // Reset FAB after timeout
            setTimeout(() => {
                fab.innerHTML = '<i class="fas fa-microphone"></i>';
                fab.style.background = '';
            }, 5000);
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message) {
                // Add user message to chat
                addChatMessage(message, 'user');
                
                // Send to AI
                socket.emit('ai_chat', { message: message });
                
                // Clear input
                input.value = '';
                
                // Show typing indicator
                showTypingIndicator();
            }
        }

        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chat-preview');
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message ${sender}-message`;
            
            if (sender === 'user') {
                messageElement.innerHTML = `
                    <div class="chat-bubble user-bubble" style="background: var(--mobile-primary); margin-left: auto; border-radius: 1rem 1rem 0.25rem 1rem;">
                        ${message}
                    </div>
                `;
                messageElement.style.justifyContent = 'flex-end';
            } else {
                messageElement.innerHTML = `
                    <div class="chat-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="chat-bubble">
                        ${message}
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chat-preview');
            const typingElement = document.createElement('div');
            typingElement.className = 'chat-message ai-message typing-indicator';
            typingElement.innerHTML = `
                <div class="chat-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="chat-bubble">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Remove after AI responds
            setTimeout(() => {
                if (typingElement.parentNode) {
                    typingElement.remove();
                }
            }, 3000);
        }

        // Socket.IO event handlers
        socket.on('dashboard_data', function(data) {
            updateDashboardData(data);
        });

        socket.on('ai_response', function(data) {
            // Remove typing indicator
            document.querySelectorAll('.typing-indicator').forEach(el => el.remove());
            
            // Add AI response
            addChatMessage(data.message, 'ai');
        });

        socket.on('speech_recognized', function(data) {
            if (data.text) {
                // Add recognized speech to chat
                addChatMessage(data.text, 'user');
                
                // Send to AI
                socket.emit('ai_chat', { message: data.text });
            }
        });

        function updateDashboardData(data) {
            // Update stats with real data
            if (data.stats) {
                document.getElementById('lessons-completed').textContent = data.stats.lessons || '12';
                document.getElementById('time-spent').textContent = data.stats.timeSpent || '2h 35m';
                document.getElementById('achievements').textContent = data.stats.achievements || '8';
                document.getElementById('streak-days').textContent = data.stats.streak || '15';
            }
            
            // Update activity list
            if (data.activities) {
                updateActivityList(data.activities);
            }
            
            // Update notification count
            if (data.notifications) {
                document.getElementById('notification-count').textContent = data.notifications.count || '3';
            }
        }

        function updateActivityList(activities) {
            const activityList = document.getElementById('activity-list');
            
            // Clear existing activities
            activityList.innerHTML = '';
            
            // Add new activities
            activities.forEach(activity => {
                const activityElement = document.createElement('div');
                activityElement.className = 'mobile-card activity-item';
                activityElement.innerHTML = `
                    <div class="activity-icon" style="background: ${activity.iconBg};">
                        <i class="${activity.icon}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-meta">${activity.meta}</div>
                    </div>
                    <div class="activity-score">${activity.score}</div>
                `;
                
                activityList.appendChild(activityElement);
            });
        }

        // Add typing animation styles
        const style = document.createElement('style');
        style.textContent = `
            .typing-dots {
                display: flex;
                gap: 4px;
                align-items: center;
            }
            
            .typing-dots span {
                width: 6px;
                height: 6px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                animation: typing-bounce 1.4s infinite;
            }
            
            .typing-dots span:nth-child(2) {
                animation-delay: 0.2s;
            }
            
            .typing-dots span:nth-child(3) {
                animation-delay: 0.4s;
            }
            
            @keyframes typing-bounce {
                0%, 60%, 100% {
                    transform: translateY(0);
                    opacity: 0.4;
                }
                30% {
                    transform: translateY(-10px);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>